<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnfuadesarrollo.blob.core.windows.net/estilosfua/style.css" />
  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
    crossorigin="anonymous"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
  />
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
    rel="stylesheet"
  />
  <!-- FAVICON -->
  <link rel="icon" type="image/jpg" href="https://cdnfuadesarrollo.blob.core.windows.net/estilosfua/Favicono.png"/>
  <title>Registro Asistencia</title>
  
</head>
<body>
  <div class="registrer">
    <div class="left-side">
      <img
        src="https://cdnfuadesarrollo.blob.core.windows.net/estilosfua/funda-logo-3.png"
        class="logo"
        alt="Logo Fundación"
      />
    </div>

    <div class="right-side">
      <h5 class="mt-3">{{ capacitacion.tipo }}:</h5>
      <h3 class="topic-tittle">{{ capacitacion.tema }}</h3>
      
      {% if not is_active %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          Ya no se admiten registros para este evento.
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endif %}
      
      {% if error_message %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="bi bi-exclamation-circle-fill me-2"></i>
          {{ error_message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endif %}

      <!-- Contenedor para mensajes de error -->
      <div id="error-message" class="mt-3"></div>

      <div class="form-card">
        <h4 class="mb-4 text-center text-black">Registro de Asistencia</h4>
        
        <form id="registrationForm" method="post" onsubmit="event.preventDefault(); getLocationAndSend();">
          {% csrf_token %}
          
          <input type="hidden" name="topic" value="{{ form.initial.topic }}">
          <input type="hidden" name="mode" value="{{ form.initial.mode }}">
          <input type="hidden" name="privacidad" value="{{ form.initial.privacidad }}">
          <input type="hidden" name="tipo" value="{{ form.initial.tipo }}">
          <input type="hidden" name="location" value="{{ form.initial.location }}">
          <input type="hidden" name="url_reunion" {% if form.initial.url_reunion %} value="{{ form.initial.url_reunion }}" {% else %} value="without-url" {% endif %}>
          <input type="hidden" name="in_charge" value="{{ form.initial.in_charge }}">
          <input type="hidden" id="latitude" name="latitude" value="">
          <input type="hidden" id="longitude" name="longitude" value="">
          
          <div class="form-section">
            <h5 class="form-section-title">Información del Evento</h5>
            <div class="row g-3">
              <div class="col-md-6">
                <div class="mb-3">
                  <div class="form-label">Objetivo:</div>
                  <div class="form-value">{{ form.initial.objective }}</div>
                  <input type="hidden" name="objective" value="{{ form.initial.objective }}">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <div class="form-label">Área:</div>
                  <div class="form-value">{{ form.initial.department }}</div>
                  <input type="hidden" name="department" value="{{ form.initial.department }}">
                </div>
              </div>
            </div>
            
            <div class="row g-3">
              <div class="col-md-6">
                <div class="mb-3">
                  <div class="form-label">Moderador:</div>
                  <div class="form-value">{{ form.initial.moderator }}</div>
                  <input type="hidden" name="moderator" value="{{ form.initial.moderator }}">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <div class="form-label">Fecha:</div>
                  <div class="form-value">{{ form.initial.date }}</div>
                  <input type="hidden" name="date" value="{{ form.initial.date }}">
                </div>
              </div>
            </div>
            
            <div class="row g-3">
              <div class="col-md-4">
                <div class="mb-3">
                  <div class="form-label">Hora Inicial:</div>
                  <div class="form-value">{{ form.initial.start_time|time:"h:i A" }}</div>
                  <input type="hidden" name="start_time" value="{{ form.initial.start_time|time:"H:i" }}">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <div class="form-label">Hora Final:</div>
                  <div class="form-value">{{ form.initial.end_time|time:"h:i A" }}</div>
                  <input type="hidden" name="end_time" value="{{ form.initial.end_time|time:"H:i" }}">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <div class="form-label">Modalidad:</div>
                  <div class="form-value">{{ form.initial.mode }}</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="alert alert-info alert-dismissible fade show" role="alert">
            <i class="bi bi-geo-alt-fill me-2"></i>
            Luego de ingresar tu documento de identidad, debes <strong>permitir</strong> el acceso a tu <strong>ubicación</strong> para completar el registro.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>

          <div class="id-capture mt-4">
            <!-- Campo de documento de identidad -->
            <div class="mb-3">
              <label for="document_id" class="form-label">Documento de Identidad del Asistente:</label>
              {{ form.document_id }}
            </div>
            
            <!-- Campo de contraseña -->
            <div class="mb-3" id="password-field"> <!-- Con ese ID podemos mostrar u ocultar segun sea necesario -->
              <label for="password_id" class="form-label">Contraseña de la intranet:</label>
              {{ form.password_id }}
            </div>

            <div class="text-center">
              <button type="submit" class="btn btn-funda" {% if not is_active %} disabled {% endif %}>
                <i class="bi bi-check-circle me-2"></i>Registrar Asistencia
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

      <!-- Spinner de carga con Camion -->
      <div id="loading-spinner" style="display: none;"> <!-- Contenedor principal del spinner, oculto por defecto -->
        <div class="spinner-container"> <!-- contenedor que centra el spinner en la pantalla -->
          <div class="loader"> <!-- contenedor del camion -->
            <div class="truckWrapper"> <!-- Envoltura del camion, define el area donde se mueve -->
              <div class="truckBody"> <!-- cuerpo principal del camion -->
                <svg>

                  <!-- 'scale' aumenta el tamaño del camion, 'translate(-70, 82)' mueve el camion 82 unidades hacia abajo'-->
                  <g transform="scale(0.88) translate(-70, 82)"> <!-- Posicionamiento del camion -->

                    <path style="stroke: rgb(0, 0, 0); stroke-width: 1; transform-origin: -12.844px -30.973px; fill: rgb(94, 94, 94);" d="M -14.812 -53.947 H -10.876 A 5.168 5.168 0 0 1 -5.708 -48.779 V -13.167 A 5.168 5.168 0 0 1 -10.876 -7.999 H -12.844 A 7.136 22.974 0 0 1 -19.98 -30.973 V -48.779 A 5.168 5.168 0 0 1 -14.812 -53.947 Z" bx:shape="rect -19.98 -53.947 14.272 45.948 5.168 5.168 5.168 27.54 1@a13bd6dc" transform="matrix(-0.014868, 0.999889, -0.999889, -0.014868, 215.297567, 83.672243)"></path>
                    <rect x="66.096" y="42.296" width="25.092" height="23.256" style="transform-box: fill-box; transform-origin: 115.517% 59.9999%; stroke: rgb(199, 100, 0); fill: rgb(249, 144, 44); stroke-width: 1.5px;" rx="0.612" ry="0.612"></rect>
                    <path style="transform-box: fill-box; transform-origin: 50% 50%; stroke: rgb(199, 100, 0); fill: rgb(249, 144, 44); stroke-width: 1.5px;" transform="matrix(0.999999, -0.001166, 0.001166, 0.999999, 18.361281, 7.549959)" d="M 52.736 7.206 H 86.291 A 6.733 6.733 0 0 1 93.024 13.939 V 43.925 A 6.733 6.733 0 0 1 86.291 50.658 H 54.469 A 6.733 6.733 0 0 1 47.736 43.925 V 12.206 A 5 5 0 0 1 52.736 7.206 Z" bx:shape="rect 47.736 7.206 45.288 43.452 5 6.733 6.733 6.733 1@1e3eeedc"></path>
                    <rect x="66.095" y="11.696" width="26.316" height="32.436" style="transform-box: fill-box; transform-origin: 50% 50%; stroke: rgb(199, 100, 0); fill: rgb(249, 144, 44); stroke-width: 1.5px;" transform="matrix(0.963495, 0.267725, -0.267725, 0.963495, 6.119963, 17.747832)"></rect>
                    <path d="M 96.389 -7.276 L 116.246 2.978 L 121.15 26.018 L 107.409 44.495 L 85.369 44.495 L 71.628 26.018 L 76.532 2.978 Z" bx:shape="n-gon 96.389 19.958 25.398 27.234 7 0 1@95c6d197" style="transform-box: fill-box; transform-origin: 50% 50%; stroke: rgb(199, 100, 0); fill: rgb(249, 144, 44); stroke-width: 1.5px;" transform="matrix(0.879843, 0.475264, -0.475264, 0.879843, -0.61199, 0.612)"></path>
                    <rect x="95.159" y="0.065" width="18.06" height="43.108" style="transform-box: fill-box; transform-origin: 50% 50%; stroke: rgb(199, 100, 0); fill: rgb(249, 144, 44);" transform="matrix(0.986473, 0.163926, -0.163926, 0.986473, -12.696068, 8.436934)"></rect>
                    <rect x="160.343" y="61.879" width="56.304" height="6.732" style="stroke: rgb(0, 0, 0); fill: rgb(81, 73, 64);"></rect>
                    <rect x="212.974" y="23.936" width="9.792" height="23.256" style="stroke: rgb(0, 0, 0); fill: rgb(43, 42, 42);"></rect>
                    <path style="fill: rgb(199, 100, 0); stroke: rgb(199, 100, 0);" d="M 89.331 -3.321 H 91.327 A 1.9 1.9 0 0 1 93.227 -1.421 V 56.404 A 1.9 1.9 0 0 1 91.327 58.304 H 91.231 A 1.9 1.9 0 0 1 89.331 56.404 V -3.321 Z" bx:shape="rect 89.331 -3.321 3.896 61.625 0 1.9 1.9 1.9 1@526b9ea0"></path>
                    <g style="" transform="matrix(1, 0, 0, 0.874999, 0, -0.484502)">
                      <rect x="90.575" y="-3.876" width="125.459" height="78.335" style="stroke: rgb(199, 100, 0); fill: rgb(249, 144, 44);" rx="1.836" ry="1.836"></rect>
                    </g>
                    <rect x="195.385" y="60.205" width="29.988" height="4.896" style="stroke: rgb(81, 73, 63); fill: rgb(90, 81, 75);" rx="0.708" ry="0.708"></rect>
                    <path style="stroke: rgb(81, 72, 64); fill: rgb(81, 73, 64);" d="M 94.437 57.853 H 156.192 A 3.7 3.672 0 0 1 159.892 61.525 V 64.843 A 0.354 0.354 0 0 1 159.538 65.197 H 91.091 A 0.354 0.354 0 0 1 90.737 64.843 V 61.525 A 3.7 3.672 0 0 1 94.437 57.853 Z" bx:shape="rect 90.737 57.853 69.155 7.344 3.7 3.7 0.354 0.354 1@f99cd74f"></path>
                    <rect x="147.491" y="61.879" width="28.764" height="7.956" style="fill: rgb(81, 73, 64); stroke: rgb(81, 73, 63);" rx="4.284" ry="4.284"></rect>
                    
                    <!-- LLANTA TRASERA CENTRAL -->
                    <g class="wheel-center">
                      <ellipse style="stroke: rgb(0, 0, 0); fill: rgb(90, 83, 75);" cx="143.513" cy="74.153" rx="15.606" ry="14.382"></ellipse>
                      <path d="M 143.696 73.887 m -8.322 0 a 8.322 9.208 0 1 0 16.644 0 a 8.322 9.208 0 1 0 -16.644 0 Z M 143.696 73.887 m -3.08 0 a 3.08 3.407 0 0 1 6.16 0 a 3.08 3.407 0 0 1 -6.16 0 Z" bx:shape="ring 143.696 73.887 3.08 3.407 8.322 9.208 1@7fbaee16" style="stroke: rgb(0, 0, 0); fill: rgb(173, 162, 148);"></path>
                    </g>

                    <path style="stroke: rgb(0, 0, 0); fill: rgb(43, 42, 42);" d="M 268.539 67.511 H 279.352 A 3 3 0 0 1 282.352 70.511 V 75.657 H 268.539 V 67.511 Z" bx:shape="rect 268.539 67.511 13.813 8.146 0 3 0 0 1@9eafbf5d"></path>
                    <path style="stroke: rgb(0, 0, 0); transform-box: fill-box; transform-origin: 50% 50%; fill: rgb(249, 144, 44);" d="M -279.482 -81.085 H -240.403 A 11.628 11.628 0 0 1 -228.775 -69.457 V -27.801 A 11.628 11.628 0 0 1 -240.403 -16.173 H -261.41 A 29.7 29.7 0 0 1 -291.11 -45.873 V -69.457 A 11.628 11.628 0 0 1 -279.482 -81.085 Z" bx:shape="rect -291.11 -81.085 62.335 64.912 11.628 11.628 11.628 29.7 1@eab0e343" transform="matrix(-0.999869, -0.016156, 0, -1.000131, 510.197968, 91.877087)"></path>
                    <path style="stroke: rgb(0, 0, 0); stroke-width: 1; transform-box: fill-box; transform-origin: 46.3754% 55.6835%; fill: url(#gradient-0);" transform="matrix(-0.967046, -0.254601, -0.417131, -1.143898, 309.710028, 38.623938)" d="M -38.542 -22.657 H -32.822 A 1.418 1.418 0 0 1 -31.404 -21.239 V -5.937 A 1.418 1.418 0 0 1 -32.822 -4.519 H -35.682 A 4.278 4.905 0 0 1 -39.96 -9.424 V -21.239 A 1.418 1.418 0 0 1 -38.542 -22.657 Z" bx:shape="rect -39.96 -22.657 8.556 18.138 1.418 1.418 1.418 4.905 1@ede6d3e4"></path>
                    
                    <!-- LLANTA TRASERA IZQUIERDA -->
                    <g class="wheel-left">
                      <ellipse style="stroke: rgb(0, 0, 0); fill: rgb(90, 82, 75);" cx="109.241" cy="73.541" rx="15.606" ry="14.382"></ellipse>
                      <path d="M 109.165 73.533 m -8.5 0 a 8.5 9.208 0 1 0 17 0 a 8.5 9.208 0 1 0 -17 0 Z M 109.165 73.533 m -3.145 0 a 3.145 3.407 0 0 1 6.29 0 a 3.145 3.407 0 0 1 -6.29 0 Z" bx:shape="ring 109.165 73.533 3.145 3.407 8.5 9.208 1@8820f2c9" style="stroke: rgb(0, 0, 0); fill: rgb(173, 163, 149);"></path>
                    </g>

                    <path style="fill: rgb(249, 144, 44); stroke: rgb(208, 105, 1);" d="M 237.454 20.264 H 258.054 A 10 10 0 0 1 268.054 30.264 V 64.328 A 3.06 3.06 0 0 1 264.994 67.388 H 237.454 A 3.06 3.06 0 0 1 234.394 64.328 V 23.324 A 3.06 3.06 0 0 1 237.454 20.264 Z" bx:shape="rect 234.394 20.264 33.66 47.124 3.06 10 3.06 3.06 1@4599f921"></path>
                    
                    <!-- LLANTA TRASERA DERECHA -->
                    <g class="wheel-right">
                      <ellipse style="stroke: rgb(0, 0, 0); fill: rgb(90, 83, 75);" cx="230.416" cy="73.991" rx="15.606" ry="14.382"></ellipse>
                      <path d="M 230.466 73.886 m -8.677 0 a 8.677 9.208 0 1 0 17.354 0 a 8.677 9.208 0 1 0 -17.354 0 Z M 230.466 73.886 m -3.21 0 a 3.21 3.407 0 0 1 6.42 0 a 3.21 3.407 0 0 1 -6.42 0 Z" bx:shape="ring 230.466 73.886 3.21 3.407 8.677 9.208 1@e047274f" style="stroke: rgb(0, 0, 0); fill: rgb(173, 162, 148);"></path>
                    </g>

                    <rect x="99.143" y="4.16" width="108.935" height="49.572" style="fill: none; fill-rule: nonzero; stroke: rgb(199, 100, 0); stroke-width: 2px;"></rect>
                    <text style="fill: rgb(111, 162, 40); fill-rule: evenodd; font-family: Alatsi; font-size: 30.3867px; paint-order: stroke; stroke-dashoffset: -3px; stroke-linejoin: bevel; stroke-width: 26.0774px; text-rendering: geometricprecision; white-space: pre;" transform="matrix(2.359107, 0, 0, 1.977962, -228.385406, -40.792038)" x="162.791" y="47.532" dx="1.497" dy="-0.912">V</text>
                    <path style="stroke: rgb(0, 0, 0); stroke-linejoin: bevel; stroke-linecap: round; transform-box: fill-box; transform-origin: 50% 50%; fill: url(#gradient-1);" d="M -238.357 -35.882 H -219.706 A 6.4 6.4 0 0 1 -213.306 -29.482 V -23.984 A 0.946 0.946 0 0 1 -214.252 -23.038 H -238.454 A 1.796 1.796 0 0 1 -240.25 -24.834 V -33.989 A 1.893 1.893 0 0 1 -238.357 -35.882 Z" bx:shape="rect -240.25 -35.882 26.944 12.844 1.893 6.4 0.946 1.796 1@826372b5" transform="matrix(0.999384, 0.035087, -0.000072, 1.000614, 478.303532, 59.414491)"></path>
                    <ellipse style="stroke: rgb(0, 0, 0);" cx="243.187" cy="46.92" rx="2.835" ry="0.612"></ellipse>
                    <rect style="fill: rgb(97, 90, 78); stroke: rgb(81, 73, 64);" x="186.046" y="66.163" width="20.196" height="13.464" rx="2" ry="2"></rect>
                    <path style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" d="M 192.778 67.033 C 192.778 71.113 192.778 75.193 192.778 79.273"></path>
                    <path style="fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0);" d="M 200.122 67.032 C 200.122 71.112 200.122 75.192 200.122 79.272"></path>
                    <defs>
                      <style bx:fonts="Alatsi">@import url(https://fonts.googleapis.com/css2?family=Alatsi%3Aital%2Cwght%400%2C400&amp;display=swap);</style>
                      <linearGradient gradientUnits="userSpaceOnUse" x1="-35.682" y1="-22.657" x2="-35.682" y2="-4.519" id="gradient-0">
                        <stop offset="0" style="stop-color: rgb(84.706% 84.706% 84.706%)"></stop>
                        <stop offset="1" style="stop-color: rgb(48.42% 48.42% 48.42%)"></stop>
                      </linearGradient>
                      <linearGradient gradientUnits="userSpaceOnUse" x1="-226.778" y1="-35.882" x2="-226.778" y2="-23.038" id="gradient-1">
                        <stop offset="0" style="stop-color: rgb(84.706% 84.706% 84.706%)"></stop>
                        <stop offset="1" style="stop-color: rgb(48.42% 48.42% 48.42%)"></stop>
                      </linearGradient>
                    </defs>
                    <rect x="66.311" y="63.616" width="23.729" height="3.187" style="stroke: rgb(0, 0, 0); fill: rgb(43, 42, 42);"></rect>
                    <rect x="274.913" y="57.596" width="6.375" height="4.958" style="paint-order: stroke; stroke: rgb(236, 223, 0); fill: rgb(255, 241, 0);"></rect>
                  </g>
                </svg>


            <div class="road"></div> <!-- carretera y lampara -->
              <svg 
                xml:space="preserve" 
                viewBox="0 0 453.459 453.459" 
                xmlns:xlink="http://www.w3.org/1999/xlink" 
                xmlns="http://www.w3.org/2000/svg" 
                id="Capa_1" 
                version="1.1" 
                fill="#000000" 
                class="lampPost" 
              > 
              <path 
                d="M252.882,0c-37.781,0-68.686,29.953-70.245,67.358h-6.917v8.954c-26.109,2.163-45.463,10.011-45.463,19.366h9.993 
                c-1.65,5.146-2.507,10.54-2.507,16.017c0,28.956,23.558,52.514,52.514,52.514c28.956,0,52.514-23.558,52.514-52.514 
                c0-5.478-0.856-10.872-2.506-16.017h9.992c0-9.354-19.352-17.204-45.463-19.366v-8.954h-6.149C200.189,38.779,223.924,16,252.882,16 
                c29.952,0,54.32,24.368,54.32,54.32c0,28.774-11.078,37.009-25.105,47.437c-17.444,12.968-37.216,27.667-37.216,78.884v113.914 
                h-0.797c-5.068,0-9.174,4.108-9.174,9.177c0,2.844,1.293,5.383,3.321,7.066c-3.432,27.933-26.851,95.744-8.226,115.459v11.202h45.75 
                v-11.202c18.625-19.715-4.794-87.527-8.227-115.459c2.029-1.683,3.322-4.223,3.322-7.066c0-5.068-4.107-9.177-9.176-9.177h-0.795 
                V196.641c0-43.174,14.942-54.283,30.762-66.043c14.793-10.997,31.559-23.461,31.559-60.277C323.202,31.545,291.656,0,252.882,0z 
                M232.77,111.694c0,23.442-19.071,42.514-42.514,42.514c-23.442,0-42.514-19.072-42.514-42.514c0-5.531,1.078-10.957,3.141-16.017 
                h78.747C231.693,100.736,232.77,106.162,232.77,111.694z" 
              ></path> 
              </svg> 
              </div> 
            </div>
            <p class="spinner-text">Procesando, por favor espere...</p>
          </div>
        </div>

  <script>
    // Función para verificar si se debe mostrar el campo de contraseña
    document.addEventListener('DOMContentLoaded', function() {
      // Obtener el valor de verificación de identidad desde la capacitación
      const verificacionIdentidad = "{{ capacitacion.verificacion_identidad }}";
      console.log("Verificación de identidad:", verificacionIdentidad);
      
      // Si la verificación de identidad es "NO", ocultar el campo de contraseña
      if (verificacionIdentidad === "NO") {
        const passwordField = document.getElementById('password-field');
        if (passwordField) {
          passwordField.style.display = 'none';
          // También hacer que el campo no sea requerido
          const passwordInput = document.querySelector('input[name="password_id"]');
          if (passwordInput) {
            passwordInput.required = false;
          }
        }
      } else {
        // Si está configurada como "SI", mostrar el campo de contraseña
        document.getElementById('password-field').style.display = 'block';
        const passwordInput = document.querySelector('input[name="password_id"]');
        if (passwordInput) {
          passwordInput.required = true;
        }
      }
    });

    // Aplicar clases de animación a elementos al cargar la página
    document.addEventListener('DOMContentLoaded', function() {
      // Animar elementos con retraso secuencial
      const formSections = document.querySelectorAll('.form-section');
      formSections.forEach((section, index) => {
        setTimeout(() => {
          section.classList.add('animate__animated', 'animate__fadeIn');
        }, 200 * index);
      });
      
      // Verificar que el spinner funcione correctamente
      console.log("DOM cargado, spinner disponible:", document.getElementById('loading-spinner'));
    });
    
    function getLocationAndSend() {
      if (navigator.geolocation) {
        // Mostrar el spinner antes de solicitar la ubicación
        showSpinner();
        
        navigator.geolocation.getCurrentPosition(function(position) {
          document.getElementById('latitude').value = position.coords.latitude;
          document.getElementById('longitude').value = position.coords.longitude;
          document.getElementById('error-message').innerHTML = ''; // Limpiar mensajes de error previos
          // El spinner ya está visible, no es necesario llamar a showSpinner() de nuevo
          document.getElementById('registrationForm').submit(); // Enviar el formulario
        }, function(error) {
          // Ocultar el spinner en caso de error
          hideSpinner();
          
          console.log("Error obteniendo la ubicación: ", error);
          if (error.code === error.PERMISSION_DENIED) {
            document.getElementById('error-message').innerHTML = '<div class="alert alert-danger animate__animated animate__shakeX" role="alert"><i class="bi bi-exclamation-triangle-fill me-2"></i> Para continuar con el registro, es necesario permitir el acceso a su ubicación. </div>';
          } else {
            document.getElementById('error-message').innerHTML = '<div class="alert alert-warning animate__animated animate__fadeIn" role="alert"><i class="bi bi-info-circle-fill me-2"></i> Hubo un problema al obtener su ubicación. Por favor, intente nuevamente. </div>';
          }
        });
      } else {
        console.log("Geolocalización no es soportada por este navegador.");
        document.getElementById('error-message').innerHTML = '<div class="alert alert-warning animate__animated animate__fadeIn" role="alert"><i class="bi bi-info-circle-fill me-2"></i> Su navegador no soporta geolocalización. </div>';
      }
    }

    function showSpinner() {
      // Mostrar el spinner al usuario
      const spinner = document.getElementById('loading-spinner');
      console.log("Mostrando spinner:", spinner);
      spinner.style.display = 'flex';
    }
    
    function hideSpinner() {
      // Ocultar el spinner
      const spinner = document.getElementById('loading-spinner');
      spinner.style.display = 'none';
    }

    // Restaurar el spinner a none si el usuario regresa usando el botón 'atrás' del navegador
    window.addEventListener('pageshow', function(event) {
      if (event.persisted) {  // Detecta si la página se carga desde la caché
        hideSpinner();
      }
    });
    
    // Asegurarse de que el formulario no se envíe dos veces
    document.getElementById('registrationForm').addEventListener('submit', function() {
      // Deshabilitar el botón de envío para evitar múltiples envíos
      const submitButton = this.querySelector('button[type="submit"]');
      if (submitButton) {
        submitButton.disabled = true;
      }
      
      // Mostrar el spinner
      showSpinner();
    });
  </script>

<style>
  :root {
    --primary-color: #5c9c31;
    --secondary-color: #f8f9fa;
    --accent-color: #e67e22;
    --text-color: #333;
    --light-text: #6c757d;
    --border-radius: 10px;
    --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    --transition-speed: 0.3s;
  }
  
  body {
    font-family: 'Open Sans', sans-serif;
    background-color: #f5f5f5;
    color: var(--text-color);
    line-height: 1.6;
    overflow-x: hidden;
  }
  
  .registrer {
    display: flex;
    min-height: 100vh;
    background-color: #fff;
    box-shadow: var(--box-shadow);
    animation: fadeIn 1s ease-in-out;
  }
  
  .left-side {
    flex: 1;
    background: linear-gradient(135deg, #68a339 0%, #5c9c31 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    position: relative;
    overflow: hidden;
  }
  
  .left-side::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('https://cdnfuadesarrollo.blob.core.windows.net/estilosfua/pattern.png');
    background-size: cover;
    opacity: 0.1;
    animation: pulse 15s infinite alternate;
  }

  @keyframes pulse {
    0% {
      opacity: 0.05;
      transform: scale(1);
    }
    50% {
      opacity: 0.1;
      transform: scale(1.05);
    }
    100% {
      opacity: 0.15;
      transform: scale(1);
    }
  }
  
  .logo {
    max-width: 80%;
    position: relative;
    z-index: 2;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
    animation: float 6s ease-in-out infinite;
  }

  @keyframes float {
    0% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-10px);
    }
    100% {
      transform: translateY(0px);
    }
  }
  
  .right-side {
    flex: 1.5;
    padding: 3rem;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }
  
  .topic-tittle {
    color: var(--primary-color);
    font-weight: 700;
    margin-bottom: 1.5rem;
    font-size: 2rem;
    border-bottom: 2px solid var(--primary-color);
    padding-bottom: 0.5rem;
    animation: slideInRight 0.8s ease-in-out;
  }

  @keyframes slideInRight {
    from {
      transform: translateX(50px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  .form-card {
    background-color: var(--secondary-color);
    border-radius: var(--border-radius);
    padding: 2rem;
    box-shadow: var(--box-shadow);
    margin-bottom: 2rem;
    animation: fadeInUp 1s ease-out;
    transition: transform var(--transition-speed), box-shadow var(--transition-speed);
  }

  .form-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
  }

  @keyframes fadeInUp {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1,
    }
  }
  
  .form-section {
    margin-bottom: 1.5rem;
    border-bottom: 1px solid #eee;
    padding-bottom: 1rem;
    animation-duration: 0.8;
    animation-fill-mode: both;
    animation-name: fadeIn;
    animation-delay: calc(var(--animation-order) * 00.1s);
  }
  
  .form-section:last-child {
    border-bottom: none;
  }
  
  .form-section-title {
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 1rem;
    position:relative;
    display: inline-block;
  }

  .form-section-title::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: -5px;
    left: 0;
    background-color: var(--primary-color);
    transition: width 0.3s ease;
  }

  .form-section:hover .form-section-title::after {
    width: 100%;
  }
  
  .form-label {
    font-weight: 600;
    color: var(--light-text);
    margin-bottom: 0.5rem;
    transition: color var(--transition-speed);
  }
  
  .form-value {
    font-weight: 400;
    color: var(--text-color);
    transition: transform var(--transition-speed);
  }

  .form-section:hover .form-value {
    transform: translateY(5px);
  }
  
  /* Estilos para btn-funda */
  .btn-funda {
    background-color: #5c9c31 !important;
    border-color: #5c9c31 !important;
    color: #fff !important;
    min-width: 160px;
    min-height: 45px;
    font-size: 1.15rem;
    font-weight: 500;
    border-radius: 8px;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    position: relative;
    overflow: hidden;
    z-index: 1;
    box-shadow: 0 2px 5px rgba(92, 156, 49, 0.2);
  }

  /* Efecto de brillo deslizante */
  .btn-funda::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 50%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.2),
      transparent
    );
    transform: skewX(-25deg);
    transition: left 0.7s cubic-bezier(0.23, 1, 0.32, 1);
    z-index: -1;
  }

  /* Efecto de borde brillante */
    .btn-funda::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 8px;
    border: 2px solid transparent;
    background: linear-gradient(45deg, #84c754, #5c9c31, #3c6922) border-box;
    -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: destination-out;
    mask-composite: exclude;
    -webkit-mask-composite: xor; /* Alternativa más compatible */
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .btn-funda:hover::before {
    left: 150%;
  }

  .btn-funda:hover::after {
    opacity: 0.7;
  }

  .btn-funda:active {
    background-color: #3c6922 !important;
    border-color: #3c6922 !important;
    transform: scale(0.97);
    box-shadow: 0 1px 3px rgba(92, 156, 49, 0.3);
  }

  .btn-funda:hover {
    background-color: #4c8927 !important;
    border-color: #4c8927 !important;
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 5px 15px rgba(92, 156, 49, 0.4);
  }

  .btn-funda:disabled {
    background-color: #727272 !important;
    border-color: #727272 !important;
    transform: none;
    box-shadow: none;
    opacity: 0.7;
    cursor: not-allowed;
  }

  .btn-funda:disabled::before,
  .btn-funda:disabled::after {
    display: none;
  }

  .id-capture {
    background-color: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: var(--box-shadow);
    display: flex;
    flex-direction: column;
    gap: 1rem;
    animation: fadeInUp 1.2s ease-out;
    transition: transform var(--transition-speed), box-shadow var(--transition-speed);
  }

  .id-capture:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
  }

  /* Animacion para los inputs */
  input.form-control {
    transition: all 0.3s ease;
    border: 1px solid #ced4da;
  }

  input.form-control:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.25rem rgba(92, 156, 50, 0.25);
    transform: translateY(-2px);
  }

  /* Animacion para las alertas */
  .alert {
    border-radius: var(--border-radius);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    animation: slideInDown 0.5s ease-out;
  }

  @keyframes slideInDown {
    from {
      transform: translateY(-20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .alert:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  /* Spinner de carga con Camion */
    #loading-spinner {
      position: fixed; /* posicion fija para cubrir toda la pantalla */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.9); /* fondo semi-transparente */
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999; /* asegura que este por encima de todo */
    }

    .spinner-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background-color: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); /* sombra suave */
      margin-top: 100px;
    }

    .loader {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .spinner-text {
      margin-top: 20px;
      font-weight: 600;
      color: var(--primary-color);
      font-size: 1.2rem;
      text-align: center;
    }
    
    .truckWrapper { 
      width: 200px; 
      height: 120px; 
      display: flex; 
      flex-direction: column; 
      position: relative; 
      align-items: center; 
      justify-content: flex-end; 
      overflow-x: hidden; /* oculta elementos que salen del contenedor */
    } 

    /* truck upper body */ 
    .truckBody { 
      width: 180px;
      height: fit-content; 
      margin-bottom: 6px; 
      animation: motion 1s linear infinite;  /* animacion de suspension (camion) */
    }

    .truckBody .wheel-left,
    .truckBody .wheel-center,
    .truckBody .wheel-right {
      animation: counterMotion 1s linear infinite; /* Animacion de suspension (Llantas) */
    }
    /* Animacion de las llantas */
    @keyframes counterMotion {
      0% {
        transform: translateY(-1px)
      }
      10% {
        transform: translateY(1px)
      }
      100% {
        transform: translateY(-1px)
      }
    }
    
    /* truck suspension animation*/ 
    @keyframes motion { 
      0% { 
        transform: translateY(0px); 
      } 
      50% { 
        transform: translateY(3px); 
      } 
      100% { 
        transform: translateY(0px); 
      } 
    } 

    .road { 
      width: 100%; 
      height: 1.5px; 
      background-color: #282828; 
      position: relative; 
      bottom: 0; 
      align-self: flex-end; 
      border-radius: 3px; 
    } 

    .road::before { 
      content: ""; 
      position: absolute; 
      width: 20px; 
      height: 100%; 
      background-color: #282828; 
      right: -50%; 
      border-radius: 3px; 
      animation: roadAnimation 1.4s linear infinite;  /* animacion de la carretera */
      border-left: 10px solid white; 
    } 

    .road::after { 
      content: ""; 
      position: absolute; 
      width: 10px; 
      height: 100%; 
      background-color: #282828; 
      right: -65%; 
      border-radius: 3px; 
      animation: roadAnimation 1.4s linear infinite;
    }

    @keyframes roadAnimation {
      0% {
        transform: translateX(0px);
      }
      100% {
        transform: translateX(-350px);
      }
    }
  
    /* Farola */
    .lampPost {
      position: absolute;
      bottom: 0;
      right: -90%; /* posicion de la farola */
      height: 90px;
      animation: roadAnimation 1.4s linear infinite; /* la farola se mueve con la carretera */
  }
</style>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
    crossorigin="anonymous"
  ></script>
</body>
</html>
